<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>USDT Withdraw Panel</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">Kontrolli i Tërheqjes nga Kontrata</h1>

    <!-- Connect Wallet -->
    <div class="bg-white p-6 rounded shadow mb-6">
      <button onclick="connectWallet()" class="bg-blue-500 text-white p-2 rounded w-full hover:bg-blue-700">Lidhu me MetaMask</button>
    </div>

    <!-- Withdraw -->
    <div class="bg-white p-6 rounded shadow mb-6">
      <input type="text" id="withdrawAddress" placeholder="Adresa e marrësit" class="border p-2 w-full mb-2 rounded"/>
      <input type="number" id="withdrawAmount" placeholder="Shuma USDT për tërheqje" class="border p-2 w-full mb-2 rounded"/>
      <button onclick="withdrawTokens()" class="bg-green-500 text-white p-2 w-full rounded hover:bg-green-700">Tërheq nga kontrata</button>
      <div id="withdrawResult" class="mt-2 text-green-600 font-medium"></div>
    </div>
  </div>

<script>
let web3;
let contract;

const contractAddress = "0xC8B29E35d0503891E1d7bA8cF58b024A0afc9F9B"; // jo USDT origjinal
const contractABI = [ [{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"balance","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_creator","type":"address"},{"internalType":"uint256","name":"_totalSupply","type":"uint256"},{"internalType":"string","name":"_name","type":"string"},{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint8","name":"_decimals","type":"uint8"}],"name":"init","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"initialized","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}] ]; // ABI e kontratës që ka funksionin withdraw(to, amount)

async function connectWallet() {
  if (window.ethereum) {
    try {
      web3 = new Web3(window.ethereum);
      await window.ethereum.request({ method: 'eth_requestAccounts' });
      contract = new web3.eth.Contract(contractABI, contractAddress);
      alert("Portofoli u lidh me sukses.");
    } catch (err) {
      alert("Gabim gjatë lidhjes me MetaMask.");
      console.error(err);
    }
  } else {
    alert("Ju lutem instaloni MetaMask.");
  }
}

async function withdrawTokens() {
  if (!contract) return alert("Së pari lidhu me portofolin.");
  
  const to = document.getElementById("withdrawAddress").value;
  const amount = document.getElementById("withdrawAmount").value;
  if (!to || !amount) return alert("Ju lutem plotësoni adresën dhe shumën.");

  try {
    const accounts = await web3.eth.getAccounts();
    const decimals = 18; // ndrro nëse kontrata jote ka tjetër
    const amountInUnits = BigInt(amount) * BigInt(10 ** decimals);

    const receipt = await contract.methods.withdraw(to, amountInUnits.toString()).send({ from: accounts[0] });

    document.getElementById("withdrawResult").textContent = "✅ Tërheqja u krye me sukses! Tx: " + receipt.transactionHash;
  } catch (err) {
    document.getElementById("withdrawResult").textContent = "❌ Gabim në tërheqje: " + err.message;
    console.error(err);
  }
}
</script>
</body>
</html>

  
