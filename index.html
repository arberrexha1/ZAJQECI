<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USDT Token Interaction</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-6">
        <header class="text-center my-6">
            <h1 class="text-3xl font-bold text-blue-600">Interact with USDT Token</h1>
            <p class="text-lg text-gray-700">Check balance & transfer tokens</p>
        </header>

        <!-- Wallet Connection Section -->
        <div class="bg-white p-6 shadow-md rounded-lg mb-6">
            <h2 class="text-2xl font-bold mb-4">Connect Wallet</h2>
            <button onclick="connectWallet()" class="bg-blue-500 text-white rounded p-2 w-full hover:bg-blue-700">Connect with MetaMask</button>
        </div>

        <!-- Balance Section -->
        <div class="bg-white p-6 shadow-md rounded-lg mb-6">
            <h2 class="text-2xl font-bold mb-4">Check Balance</h2>
            <div class="mb-4">
                <input type="text" id="balanceAddress" placeholder="Enter Address" class="border rounded p-2 w-full mb-2" />
                <button onclick="getBalance(document.getElementById('balanceAddress').value)" class="bg-blue-500 text-white rounded p-2 w-full hover:bg-blue-700">Check Balance</button>
            </div>
            <div id="balanceResult" class="text-lg text-green-600"></div>
        </div>

        <!-- Transfer Section -->
        <div class="bg-white p-6 shadow-md rounded-lg">
            <h2 class="text-2xl font-bold mb-4">Transfer Tokens</h2>
            <div class="mb-4">
                <input type="text" id="transferToAddress" placeholder="Recipient Address" class="border rounded p-2 w-full mb-2" />
                <input type="number" id="transferAmount" placeholder="Amount (in USDT)" class="border rounded p-2 w-full mb-2" />
                <button onclick="transferTokens(document.getElementById('transferToAddress').value, document.getElementById('transferAmount').value)" class="bg-blue-500 text-white rounded p-2 w-full hover:bg-blue-700">Transfer</button>
            </div>
            <div id="transferResult" class="text-lg text-green-600"></div>
        </div>


        <!-- Transaction Status Section -->
  <!--div class="bg-white p-6 shadow-md rounded-lg mt-6">
     //       <h2 class="text-2xl font-bold mb-4">Transaction Status</h2>
       //     <div class="mb-4">
         //       <input type="text" id="txHash" placeholder="Enter Transaction Hash" class="border rounded p-2 w-full mb-2" />
           //     <button onclick="checkTransactionStatus(document.getElementById('txHash').value)" class="bg-blue-500 text-white rounded p-2 w-full hover:bg-blue-700">Check Transaction Status</button>
            //</div>
           // <div id="txStatus" class="text-lg text-gray-600"></div>
        //</div>
    //</div>//-->    

    <script>
        let web3;
        let contract;
        const contractAddress = "0x55d398326f99059fF775485246999027B3197955"; // Adresa e kontratës USDT
        const contractABI = [ [{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"constant":true,"inputs":[],"name":"_decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"_name","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"_symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burn","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"mint","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"renounceOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}]];

        // Funksioni për të lidhur portofolin me MetaMask
        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    console.log("Connected to MetaMask:", accounts[0]);
                    contract = new web3.eth.Contract(contractABI, contractAddress);
                    alert("Wallet connected!");
                } catch (error) {
                    console.error("User denied wallet connection", error);
                    alert("MetaMask connection failed. Please try again.");
                }
            } else {
                alert("Please install MetaMask to use this feature.");
            }
        }

        // Funksioni për të marrë bilancin e një adrese
        async function getBalance(address) {
            if (contract) {
                try {
                    const balance = await contract.methods.balanceOf(address).call();
                    const decimals = await contract.methods.decimals().call();
                    const formattedBalance = web3.utils.fromWei(balance, 'mwei'); // Shndërron nga "mwei" në unitin e duhur për USDT
                    document.getElementById('balanceResult').textContent = `Balance: ${formattedBalance} USDT`;
                } catch (error) {
                    console.error("Error fetching balance", error);
                    alert("Failed to fetch balance.");
                }
            } else {
                alert("Wallet not connected.");
            }
        }

 // Funksioni për të bërë transferimin e tokenëve
async function transferTokens(toAddress, amount) {
    if (web3 && contract) {
        try {
            // Shndërro sasinë në "wei"
            const amountInWei = web3.utils.toWei(amount, 'mwei');  // për USDT përdorim "mwei"
            
            // Thërrasim funksionin që bën transferimin
            const accounts = await web3.eth.getAccounts();
            const fromAddress = accounts[0]; // Adresa nga e cila do të dërgohen tokenët

            const receipt = await contract.methods.transfer(toAddress, amountInWei).send({ from: fromAddress });

            // Tregoni statusin e suksesit
            document.getElementById('transferResult').textContent = `Transfer successful! Transaction hash: ${receipt.transactionHash}`;
        } catch (error) {
            console.error("Error transferring tokens", error);
            alert("Transfer failed. Error: " + error.message);  // Shtoni mesazhin e gabimit
        }
    } else {
        alert("Please connect your wallet first.");
    }
}
     
    </script>
</body>
</html>
    </script>
</body>
</html>
