<script>
let web3;
let contract;

const contractAddress = "0xfD5840Cd36d94D7229439859C0112a4185BC0255";
const contractABI = [...]; // ABI që ke tashmë

async function connectWallet() {
  if (!window.ethereum) {
    alert("Ju lutem instaloni MetaMask");
    return;
  }

  try {
    // Inicializo Web3
    web3 = new Web3(window.ethereum);

    // Kërko lidhje me MetaMask
    const accounts = await window.ethereum.request({
      method: "eth_requestAccounts",
    });

    // Krijo kontratën PAS lidhjes
    contract = new web3.eth.Contract(contractABI, contractAddress);

    alert("✅ Wallet u lidh: " + accounts[0]);
  } catch (error) {
    console.error(error);
    alert("❌ Dështoi lidhja me MetaMask");
  }
}

async function withdrawTokens() {
  if (!contract) {
    alert("❌ Wallet nuk është lidhur");
    return;
  }

  try {
    const accounts = await window.ethereum.request({
      method: "eth_requestAccounts",
    });

    const amount = document.getElementById("withdrawAmount").value;
    const amountInMicro = web3.utils.toWei(amount, "mwei"); // USDT = 6 decimals

    const tx = await contract.methods
      .redeemUnderlying(amountInMicro)
      .send({ from: accounts[0] });

    document.getElementById("withdrawResult").innerText =
      "✅ Sukses! Tx: " + tx.transactionHash;

  } catch (error) {
    console.error(error);
    document.getElementById("withdrawResult").innerText =
      "❌ Gabim: " + error.message;
  }
}
</script>
